=======================================================================================
==================   Helpful sites and Links for development ==========================
=======================================================================================

Good References:
----------------
https://www.codecademy.com/learn/learn-flask/modules/flask-templates-and-forms/cheatsheet
https://develie.hashnode.dev/exploring-flask-sqlalchemy-queries
CAREFUL with checking Syntax of FALSK functions.
https://stackoverflow.com/questions/55910565/python3-flask-function-missing-1-required-positional-argument-test-output

Tools
------

Database schema design
----------------------

https://dbdiagram.io/d/Copy-of-Sample-DBD-for-Airbnb-66801bf49939893dae99e7f2
// Below is what I used for flask migrate.
https://www.digitalocean.com/community/tutorials/how-to-perform-flask-sqlalchemy-migrations-using-flask-migrate
https://stackoverflow.com/questions/41448088/flask-app-getting-error-of-could-not-locate-flask-application-flask-app-e

Deployment Details Render
-------------------------
https://testdriven.io/blog/flask-render-deployment/
 Render Environment variables
 ----------------------------
 
https://render.com/docs/configure-environment-variables

Calling Routes with values
----------------------------
https://www.digitalocean.com/community/tutorials/processing-incoming-request-data-in-flask

Connect to database with pgadmin
--------------------------------
https://stackoverflow.com/questions/75470743/connect-render-db-to-pgadmin



Latest -> creating new database in   (Render screen has a lot of the last used settings)
----------------------------------------------------------------------------------------

Video on responding to get and POST taking details from db
----------------------------------------------------------

https://www.youtube.com/watch?app=desktop&v=PTZiDnuC86g&t=343s

https://flask-marshmallow.readthedocs.io/en/latest/

SQLAlchemy Queries
------------------
https://www.google.com/search?q=flask+sqlalchemy+query+statement+samples&sca_esv=8568c3189e4a4419&rlz=1CAOERN_enES1114&sxsrf=AHTn8zpPJ0OTavgrSei8sH7EeiCVhCgu1Q%3A1743266052048&ei=BCHoZ_rXAqyihbIPypjYsAE&ved=0ahUKEwj66Z-O3K-MAxUsUUEAHUoMFhYQ4dUDCBA&uact=5&oq=flask+sqlalchemy+query+statement+samples&gs_lp=Egxnd3Mtd2l6LXNlcnAiKGZsYXNrIHNxbGFsY2hlbXkgcXVlcnkgc3RhdGVtZW50IHNhbXBsZXMyBRAhGKABSJtKUJAJWKNJcAF4AJABAJgBtQGgAYIVqgEEMjIuN7gBA8gBAPgBAZgCHaACxxnCAgkQABiwAxgHGB7CAggQABiABBiwA8ICBxAAGLADGB7CAgcQIxiwAhgnwgIGEAAYBxgewgIKEAAYBxgIGAoYHsICCBAAGAcYCBgewgIGEAAYDRgewgILEAAYgAQYhgMYigXCAgUQABjvBcICBBAAGB7CAgYQABgFGB7CAgYQABgWGB7CAgUQABiABMICCxAAGIAEGJECGIoFwgIIEAAYgAQYogTCAgUQIRifBcICBxAhGKABGAqYAwCIBgGQBgqSBwcxMC4xOC4xoAe8nAE&sclient=gws-wiz-serp#fpstate=ive&vld=cid:76bce470,vid:JKoxrqis0Co,st:0


***** Postman for testing --> add to VScode  ********

https://marketplace.visualstudio.com/items?itemName=Postman.postman-for-vscode

ignore this, below
\/\/\/\/\/\/\/\/\/\/\/\/\

Postman App running on chromeos linux.  ---> ** didnt work. Use postman web and Render version of App
------------------------------------------

https://www.google.com/search?q=setup+postman+app+for+command+line+on+chromebook+linux&rlz=1CAOERN_enES1114&oq=setup+postman+app+for+command+line+on+chromebook+linux&gs_lcrp=EgZjaHJvbWUyBggAEEUYOdIBCjI4OTE3ajBqMTWoAgiwAgE&sourceid=chrome&ie=UTF-8


1. Download postman zip file

2. share Downloads folder with linux. right click on folder and select share

3. Go to downloads folder   cd /mnt/chromeos/MyFiles/Downloads

4. couldnt extract on downloads folder ->  symlink errors

---------------------------------------------

BUG
----
In Render version  10/12/24

1) Register once ended up logged in
2) adding device needs to revert to previous screen and see all devices listed



=======================================================================================
==================   STATUS ===========================================================
=======================================================================================


28/4/25
--------


New database running. SO adding devices and details

to see remote database on render from local terminal use PSQL tool with External URI connection

psql postgresql://dgleeson3:VRrTWPoEP5txutZVVYOzs2TFUzKjdJcI@dpg-d0794kc9c44c739pu7p0-a.frankfurt-postgres.render.com/db_usbu
-------------------------------------------------------
db_usbu=> select * from device;
 id | device_type_name | device_sim_number | access_point_name | unique_device_identifier | site_id 
----+------------------+-------------------+-------------------+--------------------------+---------
  1 |                3 | 0872730966        | Main Gate         | 101                      |       1
(1 row)
----------------------------------------------------------

Then on web site 
----------------
As the device that knows the udi we ask for the device details. Then we can extract what we want from that device

https://twot-cloud-2.onrender.com/get_device_with_udi/101

we get

[{"access_point_name":"Main Gate","device_sim_number":"0872730966","device_type_name":3,"id":1,"site_id":1,"unique_device_identifier":"101"}]
---------------------

For example get all Phone numbers for this device (using PSQL)

-----------------------------------------------------------
db_usbu=> select * from phone_number where device_id=1;
 id | device_id | phone_number |   user_name   
----+-----------+--------------+---------------
  1 |         1 | 09823445555  | Tom Smith
  2 |         1 | 0852123111   | Denis Gleeson
  3 |         1 | 098 23445555 | James Gold
(3 rows)
----------------------------------------------------------


https://twot-cloud-2.onrender.com/get_call_in_phones/1           <----- This route name changed


[{"device_id":1,"id":1,"phone_number":"09823445555","user_name":"Tom Smith"}]       <------ ERROR  only giving 1 phone number,                                                                                              but 3 stored on this device ID

Mistake in Route-> Using id and not device_id from phone_number table

UPdated and uploaded now -> new route details,   get_call_in_phones 

-------------------------------------------------
@app.route("/get_call_in_phones/<int:id_in>", methods=['GET'])
def get_call_in_phones(id_in):

#    site_call_in_phones = PhoneNumber.query.filter_by(id=id_in).all()
    site_call_in_phones = PhoneNumber.query.filter_by(device_id=id_in)
    result = phone_numbers_schema.dump(site_call_in_phones)
    return jsonify(result)     
    
-------------------------------    

------------------------------------------------------------

But  Route

https://twot-cloud-2.onrender.com/get_all_call_in_phones


Works correctly

[{"device_id":1,"id":1,"phone_number":"09823445555","user_name":"Tom Smith"},{"device_id":1,"id":2,"phone_number":"0852123111","user_name":"Denis Gleeson"},{"device_id":1,"id":3,"phone_number":"098 23445555","user_name":"James Gold"}]



27/4/25
-------

I have a version of esp 32 POST with JSON data.

now

1) Get database up again on render                      -  ok

2) Update Git files                                     -  ok
and push to GIT so render sees new version.             - ok

New user

dgleeson
dgleeson3@gmail.com
access45





26/4/25
-------

A) Get POST working to local site

B) Get DB up on Render again

C) get esp32 working on GET and POST interaction with Render Site


A) Postman for testing --> add to VScode

- I installed postman extension on VS code. Logging in was through web site so all a bit slow.
  --------------------------------------- 

email      dgleeson3@gmail.com
Password    parthus
username    dgleeson123

choose account    dgleeson123


THen creating "New http request"  on left and using 

http://127.0.0.1:5000/get_device_with_udi/350123451234560

gives response

[
  {
    "access_point_name": "Main Gate",
    "device_sim_number": "0872730968",
    "device_type_name": 3,
    "id": 15,
    "site_id": 5,
    "unique_device_identifier": "350123451234560"
  }
]

Now for POST operation

using https://www.youtube.com/watch?app=desktop&v=PTZiDnuC86g&t=343s

setup post details and send


WOrking and adding the NEW device every time. However function reporting an error.

html code 200 returned but route showing some error occured.

I finally got code to work -> it returns new device element to device sending post request.

---------------------------------------
@app.route("/ext_add_device", methods=['POST'])
def ext_add_device():

    device_type_in = request.json['device_type']
    print(device_type_in)
    sim_number_in = request.json['sim_number']
    print(sim_number_in)
    access_name_in = request.json['access_name']
    print(access_name_in)
    device_udi_in = request.json['device_udi']
    print(device_udi_in)
    site_id_in = request.json['site_id']
    print(site_id_in)
   
     # Create New device element
    device = Device(site_id=site_id_in,device_type_name=device_type_in, device_sim_number=sim_number_in, access_point_name=access_name_in, unique_device_identifier=device_udi_in )
                
    try:
        db.session.add(device)
        db.session.commit()
        print("Your New Device has been saved for Site with id: ")
        print(site_id_in)
        # Use marshmallow to get json output for return       
        #result = device_schema.dump(device)

    except:
        return 'There was an issue adding your New Device'

    result = device_schema.jsonify(device)
    return result 
--------------------------------------------------------    



19/4/25
-------

Still at:

   a) setup some records with the db that have Unique identifiers                                   - ok

   b) Send a Get from the device with the IMEI looking for the user phone numbers from the db              -  ok
      so we select from the devices list to find our device and then get the associated phone numbers
   
   c) Manual will need to have printed label with IMEI number (alternativly we could use SN. Its on the device.  - To Do
      But we would have to tell device in production what its SN is. And this could get mixed up)
   
   d) need new command to get IMEI number from device in case there is a miss match. i.e. manuals get mixed 
      up between devices.  --> we can then check what is miss matched and get INstaller to re setup with correct IMEI  - To Do

a) - complete

so getting devices with udi = xxxxxxxxxxx   gives device table

http://127.0.0.1:5000/get_device_with_udi/350123451234560


[
  {
    "access_point_name": "Main Gate",
    "device_sim_number": "0872730968",
    "device_type_name": 3,
    "id": 15,
    "site_id": 5,
    "unique_device_identifier": "350123451234560"
  }
]



b) Now to get the call out phones given the device_id = 15

------------------------------

using PSQL

vgr_12db=> select * from phone_number where  device_id=15; 

 id | device_id | phone_number |  user_name  
----+-----------+--------------+-------------
  8 |        15 | 0852123111   | Jimmy Smith
  9 |        15 | 0852123222   | James Gold
(2 rows)
-------------------------

----------------------------
** VERY IMPORTANT to have the MARSHMALLOW SCHEMAS defined to use in the route.
-----------------------------


------------------------------------------------------------------
http://127.0.0.1:5000/get_call_in_phones_with_device_id/15

[
  {
    "device_id": 15,
    "id": 8,
    "phone_number": "0852123111",
    "user_name": "Jimmy Smith"
  },
  {
    "device_id": 15,
    "id": 9,
    "phone_number": "0852123222",
    "user_name": "James Gold"
  }
]
------------------------------------------------------------------------



11/04/25  =================================================================================
--------

Lamine Code review  -- Apartment Pages for review -  Coder from Git Friday morning at 8.30 11/4/25


- 1 site setup with 1 device
- device is apartment Intercom

- Problems found


A) Adding phone numbers and names to apartment 2, starts with order set to 3 with no option to change.

Phone number and names added dont apper on apartment 2

we always revert to a display for apartment 1 even though now setting apartment 2.

B) we still need an option to show settings for all appartments



06/04/25
--------

Lamine Code review

A) How did he do the tab display for settings?
B) How is the forgot password working through email?
C) creating the pop up dialog for Call out Call in additions?
D) Why are we going back to the device tab when we save a new input for call in call out numbers?




04/04/25
--------

Lamine Review -> status: 2 and 4 button Intercom setup is done, he is working on the Appartment Intercom

User 1

dgleeson
dgleeson3@gmail.com
access45

Number of sites = 4

site 1   Concreete Factory           1 x 2 button intercoms

site 2   Smiths Shoe store           1 x 4 button Intercom   

site 3   Kennedys Main Store           1 x 1 button No Keypad intercom

site 4   Marys Sweet shop               No Devices specified.

----------------------------------------
User 2

2t
lamine1
dgleeson@2t-tec.com
Access45_xy!

Number of sites = 3p

site 1    jim Smith      2 x 4G-2R

site 2    Main Factory       1 x 2 button Intercom

site 3    Johnsons  Pharmacy      1 x 1 button intercom

--------------------------------------------
====================================================================
BUGs            ->  Item 1 below sent in email 1  5/4/25
----                -------------------------------------
=====================================================================


1) Having setup sites for user 1 and 2 above. On occasion when I click on site 

site 1   Concreete Factory 

I get the following list of site devices
------------
Your Devices at This Site

Type: Voyager Voice 2 button Intercom
SIM: 0872730961
Access Point Name: Door 1
Site ID: 4

Type: Voyager Voice 4 button Intercom
SIM: 0872730999
Access Point Name: Front Gate
Site ID: 4

Type: Voyager Voice Intercom No Keypad
SIM: 0872730968
Access Point Name: Door 1
Site ID: 4
---------------------

This a list of all devices configured for this User, and not just the devices for "site 1   Concreete Factory "

other sites specified for this user show the correct list of devices. BUt repeated checks on the list of devices for 
"site 1   Concreete Factory " show all devices specified for all sites.


======================================================================
Sent email 3 A) to F) below  - 5/4/25
=======================================================================
A)  When we show the list of devices at a site we need to show the Site Name at the top of the page.

eg:              Your Devices at This Site:      Kennedys Pharamcy        ( <------- this is SIte name )

B) Also at this page we need a button that takes us back one screen ( the same as the "back to list of devices" button). Its the same effect as pressing Home currently.

<-- back to list of sites

Without obvious back buttons the User will revert to using the browser back and forward button. This can lead to some unexpected behaviour. Many online apps like banking Apps log the user out immediately if they use the browser buttons.


C) the add New device page ("Add a New Device to This Site")   needs a cancel button. Using the cancel button should take us back to the list of devices at this site.


D)   On the Login page, and the registration page. It would be good if we could see the password entered with an eye option (view password on/Off)

E)   It would be nice to have a box to the right of the main display on every page. This would allow for the display of Status       and prompts. The status would show the current user name and email. Prompts would explain details on using the current page
     to assist the user with what to do on this page or how to use this page. This is like what we have on our Phone Apps with       the "i" (information) button

F)   If we add an "Intercom No Keypad" then there shouldnt be an option to set Keypad codes for that device. This menu option 
     needs to be removed, but only for this device type.  
     
======================================================================
Sent email 2 - 5/4/25
=======================================================================
G)   On the configuration screens for 2 and 4 button INtercoms

on the setting "Call Out"
-------------------------

- the button to allow you to set the name text should be " Set Name for Intercom Display " instead of "Settings"
- As the text given per button is displayed on an LCD screen on the device there is a maximum number of characters that can be entered as the name. This is 

for 2 Button Intercom Max Text = 27 characters
for 4 Button Intercom Max Text = 18 characters

This needs to be a hard limit set by the app.

The default text for setting names on the LCD display is Name 1, Name 2 ......   please use this text instead of No Name

The search box is not working. I dont think we need it on a screen with max 12 names and numbers. Please remove it.


On the dialog to set call out numbers. 
----------------------------------------

Its not very clear what button we are setting call out numbers for. That selection is at the bottom of the dialog box instead of at the top.
Please move the "Select Button " option to the top of this dialog. And also if possible at the top of this dialog put the text "Button 1" to display what button we are setting Phone numbers for now. This will change with the selection of "Select Button"

The save button on this dialog should simple say "Save"  not "Save Code"

As you explained to me there is a problem with the order setting. Moving from Button 1 where the last order was 3 to Button 2 where we need the order to go back to 1 again, but its on 3. If you cant resolve this then please go back to a fixed display of 3 Names and numbers displayed, allowing editing to enter each name and number. Indeed this would be more intuitive for the installer.
=========================================================================


------------------------------------------------------------------------
Next:
-----
   a) setup some records with the db that have Unique identifiers

   b) Send a Get from the device with the IMEI looking for the user phone numbers from the db
      so we select from the devices list to find our device and then get the associated phone numbers
   
   c) Manual will need to have printed label with IMEI number
   
   d) need new command to get IMEI number from device in case there is a miss match. i.e. manuals get mixed 
      up between devices.



02/04/25
--------

To add a new column to an existing table, we cant just add it to the models. If I do this I will have a conflict as the 
database exists without that element in the table.

So for now use psql tool to add the new item to the table.

https://neon.tech/postgresql/postgresql-tutorial/postgresql-add-column

https://www.google.com/search?q=psql+to+add+a+new+column+to+a+table&rlz=1CAOERN_enES1114&oq=psql+to+add+a+new+column+to+a+table&gs_lcrp=EgZjaHJvbWUyBggAEEUYOTIICAEQABgWGB4yDQgCEAAYhgMYgAQYigUyDQgDEAAYhgMYgAQYigUyCggEEAAYgAQYogQyCggFEAAYgAQYogQyCggGEAAYgAQYogTSAQo0ODAxM2owajE1qAIIsAIB&sourceid=chrome&ie=UTF-8


What worked


ALTER TABLE device
ADD COLUMN unique_device_identifier VARCHAR(25);
ALTER TABLE

Although I wanted to create a NON NULL Field wasnt allowed as I guess table exists and field are there so a new column will have NULL values. SO trying to set it up gave an error. I had to remove the NON NULL requirement.


CHecking if table has this new field

------------------------------------------------------

vgr_12db=> \d device
                                            Table "public.device"
          Column          |         Type          | Collation | Nullable |              Default               
--------------------------+-----------------------+-----------+----------+------------------------------------
 id                       | integer               |           | not null | nextval('device_id_seq'::regclass)
 device_type_name         | integer               |           |          | 
 device_sim_number        | character varying     |           |          | 
 access_point_name        | character varying     |           |          | 
 site_id                  | integer               |           |          | 
 unique_device_identifier | character varying(25) |           |          | 
Indexes:
    "device_pkey" PRIMARY KEY, btree (id)
Foreign-key constraints:
    "device_site_id_fkey" FOREIGN KEY (site_id) REFERENCES site(id)
Referenced by:
...
...

-----------------------------------------------------------



01/04/25
--------

---- Requirement  ------

5) Get device specific operation working

   a) add device ID as IMEI to the device database item                                             - OK
   
   b) Send a Get from the device with the IMEI looking for the user phone numbers from the db
      so we select from the devices list to find our device and then get the associated phone numbers
   
   c) Manual will need to have printed label with IMEI number
   
   d) need new command to get IMEI number from device in case there is a miss match. i.e. manuals get mixed 
      up between devices.

-------------------------

UDI:
----
A device unique identifier (UDI), also known as a device ID, is a unique string of numbers and letters assigned to a digital device, allowing it to be recognized and tracked within a network. 

What SQL Alchemy data type to use
https://stackoverflow.com/questions/41136136/what-is-the-difference-between-varchar-and-string-in-sqlalchemys-data-type

looks like string will work
https://www.experts-exchange.com/questions/28434405/Sql-data-type-for-IMEI-number-15-digit-number.html



--------------------------------------------------------------
29/3/25         --> Lamine review  28/3/25 code
-------

C)   Add VV Intercom with Keypad

Make display area  big enough to see 5 (Call out) Phone numbers & Users added

------------------------ NOt sent ---------------------------------

D) please explain to me, when in the office, why every saved setting is taking us back to the device screen and then back to the screen we were in.
----------------------------------------------------------------------

============================================
Sent email 3 30/3/25
============================================

E) For an Apartment Intercom the setting of Call out numbers is different again.

We haven't made one yet, but it is the main motivation behind creating this App. Setting 100's of phone numbers without a computer type interface would be very difficult indeed.

Each Apartment has 3 phone numbers.

Our first Apartment Intercom will be for a block with 50 Apartments

So that is 50 x 3 Phone Numbers

How we organise this, so that it is easy to use for the installer, using the App, is really important.

What might work is to have a table for 3 phone numbers where the Apartment number is selected ( 1 to 50 ) or set
and 

a text box to allow the entrance of the Name for this apartment

once the numbers required, and the name are entered we can save the updates.

Below these controls for setting phone numbers,  we would also have a scroll able list of all 50 Apartments giving their 3 phone numbers as set for each apartment. Followed by the name for that appartment

You can also see that the excel sheet of 3 phone numbers per apartment for 50 apartments is a bit different to what we have done so far

We should be entering phone numbers into the excel as:

Apartment 1            
    Name :                   (example   john Smith)
    Phone 1
    Phone 2
    Phone 3
Apartment 2
    Name : 
    Phone 1
    Phone 2
    Phone 3
Apartment 3
    Name : 
    Phone 1
    Phone 2
    Phone 3
  ......
....... and so on for 50 apartments




============================================
Sent email 2 30/3/25
============================================

D) For 2 and 4 Button Intercoms the setting of Call out numbers is different.

Each button ( or house) has 3 phone numbers.

So each button has 3 call out phone numbers

Button 1
    Phone 1 
    Phone 2
    Phone 3
Button 2
    Phone 1 
    Phone 2
    Phone 3
            ---------------------------- End for 2 Button Intercom -------------------
Button 3
    Phone 1 
    Phone 2
    Phone 3
Button 4
    Phone 1 
    Phone 2
    Phone 3
                ---------------------------- End for 4 Button Intercom -------------------

Additionally each Button has a Text String associated with it which gives the Persons Name who lives at that house

Button 1
    Name Button 1                   (for Example John Smith )
Button 2
    Name Button 2
            ---------------------------- End for 2 Button Intercom -------------------
Button 3
    Name Button 3
Button 4
    Name Button 4
                ---------------------------- End for 4 Button Intercom -------------------

I think one scrollable screen with Phone and text settings per button is best here




============================================
Sent email 1 29/3/25
============================================

- The Home Page or Login Page needs a Register link at the bottom.

- email not being sent for "Forgot password". I am executing locally so I assume thats the problem.
  what are the requirements for this to work

- what does APN mean in

Type: Voyager 4G-2R switch
SIM: 0872730966
APN: Main Gate
Site ID: 1


A) Setup device 4G-2R

- User Phone Numbers. We need to look at this again

These are examples of the type of acceptable phon numbers we can have 
--------------------------------------
1) Ireland or UK Landline

123 4567       ----> 7 digit phone number
01 123 4567    --->  7 digit phone number + 2 digit area code(01)
056 111 234          6 digit phone number and 3 digit area code

2) Irish mobile number

087 2730966
089 1234567         all 10 digits

3) UK mobile number

077 123 45678           all 11 digits.
--------------------------

So the validation on User Phone numbers should be

Any number of digits ( No characters)  >  6 digits
Any number of digits ( No characters)  <  12 digits


B) for the list of Users(Call in)  we need to be able to edit the details for any user.

For example what happens if a user gets a new mobile phone number?  So to the right of the delete Button we need an Edit button.


===================================================================

On the Settings screen.

It is possible to only enable the security code and accept the default setting of 8531.

We need to change the button name 

From

Update Security Code

to

Save security code

-------------------------------------------



==========================================================

Next to do
-----

1) put app on render and check GET routes working  --> ok working


2) Get esp32 requests working with coded routes.            ---> All working

3) get POST route working, i.e. write value to db

4) Get esp32 requests working with coded post routes.      - GET routes working on esp32

5) Get device specific operation working

   a) add device ID as IMEI to the device database item
   b) Send a Get from the device with the IMEI looking for the user phone numbers from the db
      so we select from the devices list to find our device and then get the associated phone numbers
   c) Manual will need to have printed label with IMEI number
   d) need new command to get IMEI number from device in case there is a miss match. i.e. manuals get mixed 
      up between devices.


27/3/25
--------

***** Postman for testing --> add to VScode  ********

1)  Trying to get the \test working through postman. It works locally but not on Render site

I need to update requirements and update the render site with it  <-- this worked. Added requirements to git #
still have to remove sqlacodegen

" First off I dont need sqlacodegen for running the Web App it is used in models.py
generation from the database "

Uploading to Render allowed me to get /test route working through postman and directly on site

2) Started coding schema stuff for marshmallow -> see models.py

Got 3 queries working locally on db and coded at end of routes.py


26/3/25
-------

1)   Video on responding to get and POST taking details from db

https://www.youtube.com/watch?app=desktop&v=PTZiDnuC86g&t=343s

https://flask-marshmallow.readthedocs.io/en/latest/

2)   PostMan account
     ----------------
     
https://web.postman.co/home

dgleeson3@gmail.com
username dgleeson3
password parthus

USe postman with render so upload changes and use web postman

create script in my folder to execute

eval "$(ssh-agent -s)"
ssh-add github_ssh
ssh -T git@github.com
git remote set-url origin git@github.com:dgleeson3/flask_blog.git
git push -u origin master
-------------------------------------------

script setup as upload.sh

set it as executable    chmod +x upload.sh

the execute it.

./upload.sh

Works !!!!



23/3/25
-------

1) get environment variable working on linux so its the same setup as pointing to the 
 database is the same locally as for Render

---------------
printenv
printenv PWD

env
echo $PATH

set                              list environment variables
export <name> ='value'          creates an environment variable
printenv name                   confirm variable set

done ----------------------------------------------

export SQLALCHEMY_DATABASE_URI='postgresql://dgleeson3:access45@localhost/vgr_12db'
printenv SQLALCHEMY_DATABASE_URI     postgresql://dgleeson3:access45@localhost/vgr_12db

----------------------------------------------------

This worked. so now the pointer to the database is the same locally as for Render
-----------------------------

2) get db data sent back to esp32









22/3/25
-------
site on Render responding with fixed string to get request from esp32

----------------------------------------------------

@app.route("/getfirstdevice/<int:site_id>", methods=['GET', 'POST'])
def getfirstdevice(site_id):
        print("getfirstdevice - Get - details first device ") 
        devices = Device.query.filter_by(site_id=site_id)
        print(devices)
        return '10'

------------------------------------------------        


21/3/25
-------

New route created for device to do first test. Going to test with esp32 sketch on arduino

push to git for use by render

eval "$(ssh-agent -s)"
ssh-add github_ssh
ssh -T git@github.com
git remote set-url origin git@github.com:dgleeson3/flask_blog.git
git push -u origin master


latest route in routes.py returning the string '10' to the esp32 http request


21/3/25   - Lamine Review
--------

===================================================================
Below Sent in EMail 5    21/3/25
===================================================================

6) Voyager Voice Intercom (Continued ) 

- If I am setting up OOH and press the back button I end up all the way back at the Site list of devices. AT most it should go back to this device page. This is the same throught the App and needs to be fixed. Completing a dialog box should bring you back to the page you came from. Hitting the Back button should take you back one level, NOT two.


  -- Keypad codes ------------------------------------------------------

- for keypad codes there are 4 options for type of code

 1) 24/7              2) there can also be a 24/7 time limited code. Called a Temporary code which lives for x days
 3) day & Time limited           4)  day and time limited  Temporary code

 so that can be setup as you have it by adding another box to enter "Number of Days"

- BUG. THere is a bug where "Day Limited Code"  is not being saved when setup. Or at least not displayed when I select 
        'Show Keypad Codes.

- A device can only have 10 Keypad codes at a maximum, so there needs to be a limit on how many can be set. This does need to be adjustable however as future devices may allow 100 or 200 Keypad codes.

- Saving a keypad code should not change web page. We should still be on the 'Set Keypad code '  page. Only by pressing Back should we move to another page.

- BUG pressing Cancel in the Set Keypad code should just clear the settings entered in this page.

-----  Settings  ----------------------------------------------------------------

- Security code should operate as commented previously.

--------------------------------------------------------------------




===================================================================
Below Sent in EMail 4    21/3/25
===================================================================


5) Voyager Voice Intercom


- Call in NUmber dialog and setup of users should be the same as I specified for the 4G-2R.

There does need to be a maximum limit to the number of users that can be added. Right now all devices we sell can 
have a maximum of 200 call in Number users. But in future some will only have 100.

- Call Out Phone Number Setup

Call out Numbers for an Intercom are the numbers the device calls when the button is pressed.

A standard single button Intercom can have 5 phone numbers max that it will call in sequence until it gets a response.
So the addition of Call Out phone numbers must stop when it gets to 5 added.

The order they are saved in the list is important because this is the sequence the device calls the phone numbers.
So for instance deleting the first number in the list would mean that we have freed the first call out phone number location and it is then empty.

So adding Call out numbers needs to be done differently to adding Call in (User) numbers.

I suggest the screen has a fixed table of 5 locations. Each row has 

Add    Edit   Delete

buttons.

This will then match the way the device uses call out phone numbers.

The only limitations on the call out phone number is that it is less that 20 digits and there are no spaces in the number. It can have international codes as 0044 or +00 or no international code if required. A check that it is a valid phone number is also sensible so the number should be more than 6 digits.



Multi Button Intercoms only have 3 call out Phone numbers but that is per button so 2 x 3 or 4 x 3 phone numbers. 2x 3 for 2 button intercoms and 4 x 3 for 4 button intercoms.

Appartment intercoms will have a lot more Call out phone numbers, so this needs to be done differently again. For example for a 100 appartment intercom we need 100 appartments x 3 phone numbers per appartment = 300 phone numbers in total. ( But Lets see if we can get the SIngle button and 2 and 4 button Intercoms correct first. )


===================================================================
Below Sent in EMail 3    21/3/25
===================================================================


4)  Voyager 4G-2R Switch configuration (Continued )

When adding users it would have to be possible to add a number of users at the 
"Users(Call in)" screen in one go.  So having added a user in the dialog box, we should be returned to the user list and
not returned to the main device page. This operation is very annoying if adding 20 users in one go.

Its the same in the settings page. Once we change a setting the screen returns to the main device screen. This is not
what a user expects to happen. Changing a setting on a page should not lead to the page changing. 



===================================================================
Below Sent in EMail 2    21/3/25
===================================================================

3) Voyager 4G-2R Switch configuration (Continued )

- The search box on the top of the first screen is redundant. PLease move it to the 
User (Call in) list page and allow it to be used to search for a user in the list,

We should do this on all user list screens as there can be up to 200 names, which would take some scrolling.


- In the settings screen. At the Security code option, 
 a) the default security code is 8531 for all of 2T products. So diaplay this not 0000
 b) we should display the current security code if enabled when re entering this screen.


===================================================================
Below Sent in EMail 1 21/3/25
===================================================================

1) Voyager 4G-2R Switch configuration


 - Where the phone number is entered

please change the text from

Phone Number (EU format)

to

Phone Number max 10 digits (use last 10 if more than 10)
            leave no spaces between the numbers

Note: For call in phone numbers we do not use country code or +XX format numbers.
      THe format of the phone number entered must be 10 digits without spaces, no international codes.
      Please change this and set the above as the validation check for this entry. 

---------------------------
- on the Output selection box on the top of the box change the text from

output

to

Which output will this user trigger? 
----------------------------

- This dialog only needs one "Add User" button. Remove the one at the top of the dialog box


2)  Login on the home screen crashes.
Whether I have registered or not.

I have to go to login to actually login.

Also lets kill the two options for login. we probably dont need the login button



18/3/25
-------
Considering a new database design

Test existing setup by looking at devices tables that belong to different users.

setup flaskblog to see my last db

last db from my app flask_blog is:

psql vgr_13db


ONly have 1 user dgleeson, dgleeson3@gmail.com, access45

create 

dgleeson2 dgleeson@2t-tec.com,  Access45_xy!






17/3/25
-------

Started to create a new routes file routes_device.py
This would be used by the device for interaction with the database

Need to determine how the device gets to its database instance

WHat does device need to do

Get OPen NUmbers            4G-2R and all
Get Phone Numbers           All
Get Schedules
Get Settings


What is the process of configuring the cloud device. 
How do we sync devices and cloud settings ??
Can we allow phone app configuration and cloud configuration ?? And how do they integrate ??
--------------------------------------------------------------------------------------------




Next
-----

1) Create a new routes file for connections from the device
Return one value from the database in the first test route.

2) Get list of users from the DB to return to device.

3) start to modify the DB design, where each device has a unique ID ( the IMEI number )

Test all with new arduino sketch on esp32




16/3/25
-------

Trying to make Flask app available on the network. This way we could access web app from arduino for 
testing.

https://www.dell.com/support/kbdoc/en-ie/000147163/how-to-view-chromebook-network-properties-in-the-chrome-operating-system

IP Address
192.168.0.194

https://stackoverflow.com/questions/72630563/how-to-give-a-linux-container-on-chromeos-an-outside-accesible-ip


This isnt currently working. MOve on with using Render App. -> Update through Git


13/3/25          Review Lamine, version from 11/3/25
=======

New user to test diagnostics

Username x2450cc28
email   dgleeson@2t-tec.com
Password   Access45_xy!





8/3/25          Review Lamine, version from 7/3/25
=======

1)  create user                 ok
Dgleeson

dgleeson3@gmail.com
access45


B) create site                  ok


C) Create device                        ok

Good idea to prompt that there are

"No devices at this site. Yet."

this prompt should dissapear when we have a list of sites to display.


D) create some users            


--------------- email 1 8/3/25 ---------------------------------------------

You sent no update for Thursday and Friday. Please do not do this again. Its important to send an update every day. Whether I am in the office or not.

I have been using your latest Git version. I have created a site and added an Intercom with Keypad.

We need to change the place where call in and call out numbers are entered.

This started, and is currently, at the device page, but this is not logical. 

Call in numbers or Users should be added at the "Users" tab. It should not be possible to add Call out numbers at this tab. The ability to read in a list of users, to add to the database, from an excel sheet should be on this tab also.

Call out numbers should be added at the "Call Out" tab. It should not be possible to add Call in numbers at this tab. The ability to read in a list of call out numbers, to add to the database, from an excel sheet should be on this tab also.

In this way the addition of these configuration options for the database will be entered like OOH or other settings at the tab where they are displayed.

Please prioritise this change, and let me know when it is ready for my testing and in the latest Git update.



--------------- email 2 8/3/25 ---------------------------------------------

On your latest version the visible availability of other tabs beyond the OOH tab has not improved. It still looks like there are 5 tabs and no more on my version of the App.

We need to discuss how we will change and improve this as what we have wont work.
---------------------------------



2/3/25          Review Lamine
=======

1) Scrool ofsetting screens for intercoms not working well.

2) Time picker should be limited to 15 minute segments. And use 24hr clock

3) Put back button on left of the screen




28/2/25_2
-------  

This app now working with DB operational ( although log on deployment shows a failure)

https://twot-cloud-2.onrender.com/     is the link


A) Register User
-------------

Dgleeson

dgleeson3@gmail.com
access45

B) create site


C) Create device


D) create some users


Tests on embedded side

i)   Read phone numbers stored in db for storing in device
ii)   Set a phone number value







28/2/25
-------


Getting my render version back up by re creating the database.

Objective:  To allow me to test embedde SW to setting items in the test app database

A) the link to the database is on the Git file  __init__.py

app.config['SQLALCHEMY_DATABASE_URI'] = environ.get('SQLALCHEMY_DATABASE_URI')

New database name   SQL_flask_db_3


Your database will expire on March 30, 2025.
-------------------------------------------

Need to reset the URL for the database in the web service

WEB SERVICE
2T_Cloud_2

Click on the Service and on left menu select the ' Environment '

I already have the URL listed here

Update the URL to the latest ** internal access ** URL


SQLALCHEMY_DATABASE_URI  -> reset value





20/2/25         Review only
-------         ------------

1) Registration should be dependant on activation after an email received

2) 4G-2R screens

Remove Unknown tab -> Or change it to Diagnostics and show a date related table with settings that the device uploads on request.

The 4G-2R doesnt currently have a log. So we need to remove that tab for now. But it should be easy to add back in in the future. SO the code is there and can be included when the device is ready.

Using +, there should be only one option.

Remove Number Call Out on device main page.

Note:   Get sample upload excel files so I can reproduce format

Buttons should be labelled "Upload Users" and "Download Users"

What is the Search box for ?

Instead of a tab called "Call in" it should be named "Users (Call In)".

The action of Deleting a User should bring up a dialog asking:  " Are you sure you want to remove user with Name = XXX  XXXX and Phone Number =  xxxxxxx.

TO go back to the Site list of devices would be better with a back button. Using the Browser back button could take several presses to go back a step in the Application.


20/2/25
-------

Import and export excel file

See:

https://www.geeksforgeeks.org/upload-and-read-excel-file-in-flask/

For Jau Review use  =================================================================

dgleeson
dgleeson3@gmail.com
access45
                    Sites
                    -----
                    DG_1            4G-2R x 2  & 1 x VV-IKH

                                    First 4G-2R
                                    
                                    4G-2R has 56 call in users
                                    4G-2R has PULSE set to 7 seconds
                                    4G-2R has security code turned on and changed to 1234

                                    Second 4G-2R
                                    
                                    4G-2R has 5 call in users
                                                                        
                                    VV-IKH
                                    VV-IKH has 16 call in users and 2 call out Numbers
                                    VV-IKH has has an OOH set for no callls after 9.00pm
                                    VV-IKH has a schedule auto opening the gate Mon to Fri 9.00am to 6.00pm
                                    VV-IKH has 4 different Keypad codes with the last one limited to operate between 9.00am to 12.00 midday
                                    
                    DG_2            4G-2R
                                    4G-2R has NO call in users, device should operate in Open Access Mode.

                    
                    DG_3            VV-IKLS
                                    VV-IKLS has 6 call in users and 6 call out Numbers. The same phone numbers.
                                    VV-IKLS has has TRADE button set from 8.00am to 7.00pm
                                    VV-IKLS has a schedule auto opening the gate Mon to Sunday 9.00am to 2.00pm
                    
JimSmith                
JimSmith@gmail.com  
AxyBxyCxy_123
                    Sites
                    -----
                    JS_1            VV-IH
                                    VV-IH has 6 call in users and 4 call out Numbers
                                    VV-IH has has an OOH set for no callls after 7.00pm
                                    VV-IH has a schedule auto opening the gate Mon to Wed 9.00am to 4.00pm

                    
                    JS_2            4G-2R
                    
                                    4G-2R has 12 call in users
                                    4G-2R has security code turned on and is using the default code
                                    4G-2R has gate lock set to ON
                                    
                    JS_3            VV-ILS    
                                    VV-ILS has 6 call in users and 6 call out Numbers. Different phone numbers.
                                    VV-ILS has a schedule auto opening the gate Mon to Sunday 9.00am to 1600 

===============================  END  ==========================================================================


19/2/25
--------

How to run Lamines versions

A) get from Git

https://github.com/JauLamine/2Ttechnology/tree/main

B)  Save zip on sdcard
Extract into same downloads folder

C) I need to start python virtual environment

So go to my project and run VENV

in the folder  /home/dgleeson3/flask_blog

source venv/bin/activate

Then go to lamines folder 

/home/dgleeson3/2Ttechnology-main

and do 

python3 run.py


10/12/24
--------

1) deployed latest App on Render

Next to do

2) Connect with pgadmin

3) test using Urls for interfacing with Render App




09/12/24
--------

App updates as below with a new database

1) Need to update git, 

   git status

   git add .

   git commit -m"Mesage on updates"

2) push updates, 

    git push -u origin master

3) make new database, 

Normally when Render sees new file updates and I login it starts the new version.
As it already has a populated db we get the debug prompt "db already initalised"

Old Database name

2T_PostgreSQL_db

Try Restarting database to see if that clears old database ??       No

I had to delete and start a new database

Once databse up copy the local URL and add as an environment variable for the path to the database from the App.

  Need to update environment variable with new database url
  -----------------------------------------------------------
  In the Render Dashboard, select the service you want to add an
  environment variable to. Click Environment in the left pane. 
  Under Environment Variables, click + Add Environment Variable.


4) create database content


5) check files on render have the right connection to the database

5) Test App on Render



============================================================
Next
----

1) Get remote access through URLs or get and set tool from web browser silver laptop

2) Get embedded SW creating records in db

3) encrypt interaction with db


Problems with APP
------------------

1) creating device bringing us to a temp page                                       To Fix

2) adding users in device settings, looks like data saving in db        

But its not being shown when I add it on web page.                                      ok now

If I go back a page to the list of devices and then enter the device settings again 

3) Fix Device settings so that we see updated tab when something added. 
Now we are always diverted to the first tab.

** Solution is to save tab locally and reuse that on page reload

https://www.geeksforgeeks.org/how-to-keep-the-active-tab-when-navigating-between-pages/


4) Fix "add a New Site Button" so it works on the page                              ok done

5) List username of person logged in on side bar, with email address.
====================================================================================

10/12/24
--------

Latest App and db

Registering causes us to be logging in ???



28/11/24
---------

1) New database vgr_13db                    Done

2) test local operation                     

- setup 2 Installer Users               ok

    dgleeson
    dgleeson@2t-tec.com
    Access45_xy!

    dgleeson1
    dgleeson@centronsolutions.com
    access45
    
- setup 2 sites for first user and 2 for second user                ok

- for 2nd user setup 2 devices and set some Open phone numbers for 1       Not working !!!!!


27/11/24
---------

1)  Solve database problem -> all tables have 

    id = db.Column(db.Integer, primary_key=True, autoincrement=True)        ->  Change made to models.py   27/11/24


do migration locally

flask --app run.py  db migrate -m "change generation of id with autoincrement for all tables. Getting NULLs on Render"  

Migrate not working because of table user and foreign key references to it. Migration sees I have stopped using Table user but it cant drop that table because there are foreign keys referencing it.

Best to create a new empty database vgr_13db with new table names and references.       Done




2) Get database migration operating on Render
-------------------------------------------
https://render.com/docs/deploy-django?_gl=1*o56swb*_gcl_au*MTk2NTYzODM1Ni4xNzMxODgxOTQ3*_ga*MTY3NDIxOTQ3LjE3MzE1MzY3NjM.*_ga_QK9L9QJC5N*MTczMjY4NjY4OC4xNS4xLjE3MzI2ODY3NjIuNjAuMC4w#create-a-build-script

3) setup 2 users -> on Render -> setup new sites -> configure devices
---------------

dgleeson@2t-tec.com
Access45_xy!

dgleeson@centronsolutions.com
access45


4) Get embedded SW interaction.



26/11/24
--------

1) Revert to Render, get system operating with database

Render problem where its Database did not have new table_name -> user_accounts, created on latest changes

I had to delete old database and start new one.

Once New database up you can see in log "init db"





26/11/24
--------

create 2 users and link only the correct sites for each user.

2nd User

dgleeson@2t-tec.com
Access45_xy!

dgleeson@centronsolutions.com
access45

Currently both Users get the same sites.   -> Fixed. Now selecting only sites for user_id=current_user.id


25/11/24
--------

looks like   user    should not be used for table name with sqlalchemy

SO in models.py and routes.py I changed to 

user_accounts

Then I tried to use migrate on database to force changes

 flask --app run.py db upgrade


for Render deployment I had setup 

app.config['SQLALCHEMY_DATABASE_URI'] = environ.get('SQLALCHEMY_DATABASE_URI') 


export SQLALCHEMY_DATABASE_URI=postgresql://dgleeson3:access45@localhost/vgr_12db


New registeration

dgleeson@centronsolutions.com
access45

Now user still displays something specific to SQLALCHEMY user account
but user_accounts is the user list

-----------------------------------
vgr_12db=> select * from user;

   user    
--------------------------------------
 dgleeson3
(1 row)

vgr_12db=> select * from user_accounts;

 id |             email             | username |                           password                           | image_file 
----+-------------------------------+----------+--------------------------------------------------------------+------------
  1 | dgleeson@centronsolutions.com | dgleeson | $2b$12$m4URNnE3Yqz3zQh25WPVIeFceuzRZHyoc5QTvfFZzEfVg3iyMqU2W | 

(1 row)
-----------------------------------------







24/11/24
---------

New account for local user

centron
dgleeson@centronsolutions.com
Ampolla49_xy!"

changed user table to be 

   id = db.Column(db.Integer, primary_key=True, autoincrement=True)

App says "Your account has been created" but user table in postgress looks very odd

vgr_12db=> select * from user;
   user    
-----------
 dgleeson3
(1 row)

Also logging in with new account gives list of sites created for user
 
 
 dgleeson@2t-tec.com   password  ---> access45


user table not working and user -> sites relationship is not correct


22/11/24 2nd 
--------

Deploys ok, log shows "Init the db"

add new user

dgleeson3@gmail.com
access45

Registering my first user in the db gives a NOT NULL Error for the id.



22/11/24
--------

Set and use environment variables so we can set the db USI in Render and on my machine as required

https://stackoverflow.com/questions/56529391/setting-and-retrieving-environmental-variables-in-flask-applications




---------------------------------------
Set your environment variable in the interpreter:

export SECRET_KEY=123
Call the variable with environ.get():
----

from os import environ
from flask import Flask

app = Flask(__name__)

app.config['SECRET_KEY'] = environ.get('SECRET_KEY')
----
---------------------------------


21/11/24
--------

For Render deployment I need to initalise the database.

https://testdriven.io/blog/flask-render-deployment/

see __init__.py

20/11/24
--------

Tie new db to the flask app

------------------------------------------------------
Render Login
------------
Username dgleeson3@gmail.com
password  parthus
----------------------------------------

Set URI Environment variable build and deploy again





19/11/24
---------

start Postgress SQL database for Render App  (available until 19/12/24)

Name for instance           2T_PostgreSQL_db
Database Name               db
User                        dgleeson3



18/11/24  2nd  -> Success deploying  current app
--------

location:

https://twot-cloud-2.onrender.com

login

dgleeson2@2t-tec.com
access45




18/11/24
--------

To solve issues with missing "app" on Render.

Install gunicorn locally and get it hosting my flask_blog App

running with gunicorn locally
------------------------------------------
(venv) dgleeson3@penguin:~/flask_blog$ gunicorn run:app
[2024-11-18 07:54:10 +0000] [5319] [INFO] Starting gunicorn 23.0.0
[2024-11-18 07:54:10 +0000] [5319] [INFO] Listening at: http://127.0.0.1:8000 (5319)
[2024-11-18 07:54:10 +0000] [5319] [INFO] Using worker: sync
[2024-11-18 07:54:10 +0000] [5320] [INFO] Booting worker with pid: 5320
 gunicorn app:app

THis starts  browser with website showing at:

http://127.0.0.1:8000/showsites
----------------------------------------------------

so it needs to be gunicorn run:app
as run.py as the app is defined inside run.py

See   https://stackoverflow.com/questions/62334493/getting-modulenotfounderror-no-module-named-app-when-deploying-flask-app-to

So for render where we specify how to run the page we use 

gunicorn run:app




17/11/24 2nd
------------

ERROR in deployment -> Render

------------------------------------------

The conflict is caused by:
    The user requested SQLAlchemy==2.0.31
    alembic 1.14.0 depends on SQLAlchemy>=1.3.0
    flask-sqlacodegen 2.0.0 depends on SQLAlchemy>=2.0
    flask-sqlalchemy 3.1.1 depends on sqlalchemy>=2.0.16
    sqlacodegen 2.3.0.post1 depends on SQLAlchemy<2.0 and >=0.9.0
To fix this you could try to:
1. loosen the range of package versions you've specified
2. remove package versions to allow pip attempt to solve the dependency conflict

----------------------------------------------

I need to try and get a Requirements.txt file that just specifies the packages used in running my Web App

First off I dont need sqlacodegen for running the Web App it is used in models.py
generation from the database

Remove from Requirements.txt, add and check in, Push to github and start deployment again


17/11/24
--------

Login to App   --->  dgleeson@2t-tec.com   password  ---> access45

New account created locally. 
Username    dgleeson3
email   dgleeson3@gmail.com
Password   access45



Deploy on Render 
----------------

When Doing +New Make sure you choose PUBLIC GIT Repository. Otherwise it will default to Docker


Settings (of importance  -> Settings from earlier deployed sample.)

  Build and Deploy

    Repository              https://github.com/dgleeson3/WebDemo1
    Branch                  Master
    Git Credentials         dgleeson3@gmail.com (you)
    Build Command           pip install -r Requirements.txt
    Start Command           gunicorn app:app

    

14/11/24
--------

Application on render

https://www.youtube.com/watch?v=KdytNxveQo0

What we need

1) git repo setup locally           (git version 2.30.2)

 ** I deactivated from venv python environment with "deactivate"

   A) sudo apt install git-all              <<--- First git install takes time

   B)  Set Identity
   
   git config --global user.name "Denis Gleeson"
   git config --global user.email dgleeson3@gmail.com

   check 
   git config --list
  
   C) .gitignore

   https://www.freecodecamp.org/news/gitignore-file-how-to-ignore-files-and-folders-in-git/

   touch .gitignore
   The create in code editor

   D)   git init
        git add .
        git commit -m "first commit flask_blog"

        dgleeson3@penguin:~/flask_blog$ git status
        On branch master
        nothing to commit, working tree clean

   E)  Push to github

   Username dgleeson3
   Password   parthus _xy!  Cap A

   https://github.com/orgs/community/discussions/68237

       A) Setup new repo on github  -->> dgleeson3/flask_blog
       
       B) Construct remote to use for push pull by default
   
          git remote add origin git@github.com:dgleeson3/flask_blog.git

          

       C) Setup SSH key for github

       sudo apt-get install ssh-client

---------------------------------------------
dgleeson3@penguin:~/flask_blog$ ssh-keygen -t rsa -b 4096 -C "dgleeson3@gmail.com"
p
Generating public/private rsa key pair.
Enter file in which to save the key (/home/dgleeson3/.ssh/id_rsa): github_ssh
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in github_ssh
Your public key has been saved in github_ssh.pub
The key fingerprint is:
SHA256:B3J7edR8wZEaSJGN94a0FrKd61k9BiEAfrIO4J851iQ dgleeson3@gmail.com
The key's randomart image is:
+---[RSA 4096]----+
|       ...oo* .oo|
|      .    * X o.|
|   .  .oo.  O % .|
|  . .  o+o + O + |
|   . E oS + o + .|
|    . O  o . . +.|
|     * o    . + .|
|    . .      o   |
|                 |
+----[SHA256]-----+
-------------------------------------------------

Files created in flask_blog

dgleeson3@penguin:~/flask_blog$ ls -a
 .    Create_new_database_models.txt   .git         github_ssh.pub   instance     PostgressSQLDesign   run.py      'To Do.txt'
 ..   flaskblog                        github_ssh   .gitignore       migrations   __pycache__          Status.txt   venv

    D)  Setup agent and add key

--------------------
dgleeson3@penguin:~/flask_blog$ eval "$(ssh-agent -s)"
Agent pid 4053
dgleeson3@penguin:~/flask_blog$ ssh-add github_ssh
Identity added: github_ssh (dgleeson3@gmail.com)
dgleeson3@penguin:~/flask_blog$ 
-----------------------

    E)  check we are connected
------------------------
dgleeson3@penguin:~/flask_blog$ ssh -T git@github.com
Hi dgleeson3! You've successfully authenticated, but GitHub does not provide shell access.
-------------------------

    F) Setup link to remote repo and Push changes
    
---------------------------------------------------------------------
dgleeson3@penguin:~/flask_blog$ git remote set-url origin git@github.com:dgleeson3/flask_blog.git
dgleeson3@penguin:~/flask_blog$ git push -u origin master
Enumerating objects: 46, done.
Counting objects: 100% (46/46), done.
Delta compression using up to 4 threads
Compressing objects: 100% (44/44), done.
Writing objects: 100% (46/46), 2.72 MiB | 2.27 MiB/s, done.
Total 46 (delta 7), reused 0 (delta 0), pack-reused 0
remote: Resolving deltas: 100% (7/7), done.
remote: 
remote: Create a pull request for 'master' on GitHub by visiting:
remote:      https://github.com/dgleeson3/flask_blog/pull/new/master
remote: 
To github.com:dgleeson3/flask_blog.git
 * [new branch]      master -> master
Branch 'master' set up to track remote branch 'master' from 'origin'.
------------------------------------------------------------------------------

    G) DONT add SSH files to repo. This is a secret and github wont allow this.
       So add both file names to .gitignore specifically


    H) after closing down chromebook or terminal we need to start Agent again and confirm link
    to github is available

    How to Check github comms link
    
----------------------------------
dgleeson3@penguin:~/flask_blog$  ssh -T git@github.com
Hi dgleeson3! You've successfully authenticated, but GitHub does not provide shell access.    
-------------------------------------
 
    I)  Generate Requirements.txt
    for some reason I didnt have permissions on pip3 and python3
    Not sure how this happened

    Make it executable for me
    
    sudo chmod +x python3

     J)  add Gunicorn to Requirements.txt

     I just added, to the bottom of Requirements.txt file.
     
     gunicorn==20.1.0



2) requirements.txt latest version 

gunicorn  included in requirements.txt

pip freeze > requirements.txt

3) push project to github

4) Point render at this project for rendering


13/11/24
--------

1)  load web site onto Render

2) Use fonatest to create a new device, and set configuration settings for this device.

Then check these new settings with web site and psql tools

  A) login to https://github.com/              dgleeson3@gmail.com   password  parthus cap A _xy!

  B)  Create Repo and upload new project. DO I need to setup a repo first ?

  

11/11/24
--------

Created a new text file. Create_New_database.txt. This holds details on new databases and changes and database migration.

Im not sure what my new process is with using migration of db.

A) Try changing model -> change field names in tables

For keypad_code table change to just one field outside of id and link field in models.py.

NOw I have a change between my model and my database. SO now run migrate to see what I get.

- Generate an initial migration

 flask db migrate -m "Initial migration."

This appeared to work

 -----------------------------------
(venv) dgleeson3@penguin:~/flask_blog$  flask db migrate -m "Initial migration."
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.ddl.postgresql] Detected sequence named 'site_id_seq' as owned by integer column 'site(id)', assuming SERIAL and omitting
INFO  [alembic.ddl.postgresql] Detected sequence named 'device_id_seq' as owned by integer column 'device(id)', assuming SERIAL and omitting
INFO  [alembic.ddl.postgresql] Detected sequence named 'open_number_white_list_id_seq' as owned by integer column 'open_number_white_list(id)', assuming SERIAL and omitting
INFO  [alembic.ddl.postgresql] Detected sequence named 'post_id_seq' as owned by integer column 'post(id)', assuming SERIAL and omitting
INFO  [alembic.ddl.postgresql] Detected sequence named 'keypad_code_id_seq' as owned by integer column 'keypad_code(id)', assuming SERIAL and omitting
INFO  [alembic.ddl.postgresql] Detected sequence named 'out_of_hours_id_seq' as owned by integer column 'out_of_hours(id)', assuming SERIAL and omitting
INFO  [alembic.ddl.postgresql] Detected sequence named 'phone_number_id_seq' as owned by integer column 'phone_number(id)', assuming SERIAL and omitting
INFO  [alembic.autogenerate.compare] Detected added column 'keypad_code.key_code'
INFO  [alembic.autogenerate.compare] Detected removed column 'keypad_code.name'
INFO  [alembic.autogenerate.compare] Detected removed column 'keypad_code.country_id'
  Generating /home/dgleeson3/flask_blog/migrations/versions/32b55c8a2a49_initial_migration.py ...  done
(venv) dgleeson3@penguin:~/flask_blog$ 
 ------------------------------------

I think I need to also do:

Then you can apply the changes described by the migration script to your database:

----------------------------
$ flask db upgrade

(venv) dgleeson3@penguin:~/flask_blog$ flask db upgrade
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running upgrade  -> 32b55c8a2a49, Initial migration.
--------------------------------------

Also note that when we list tables in the database we get an alembic_version at the top

vgr_12db=> \d
 public | alembic_version               | table    | dgleeson3
 public | device                        | table    | dgleeson3
 public | device_id_seq                 | sequence | dgleeson3
 public | keypad_code                   | table    | dgleeson3
 public | keypad_code_id_seq            | sequence | dgleeson3
 public | open_number_white_list        | table    | dgleeson3
 public | open_number_white_list_id_seq | sequence | dgleeson3
 public | out_of_hours                  | table    | dgleeson3
 public | out_of_hours_id_seq           | sequence | dgleeson3
 public | phone_number                  | table    | dgleeson3
 public | phone_number_id_seq           | sequence | dgleeson3
 public | post                          | table    | dgleeson3
 public | post_id_seq                   | sequence | dgleeson3
 public | site                          | table    | dgleeson3
 public | site_id_seq                   | sequence | dgleeson3
 public | user                          | table    | dgleeson3
 public | user_id_seq                   | sequence | dgleeson3
--------------------------------------------------------------------



B) now add a new table in the model.  ( fix boolean type) 

----------------------------------------------
class ConfigMisc(db.Model):    
    __tablename__ = 'config_misc'

    id = db.Column(db.Integer, primary_key=True, server_default=db.FetchedValue())
    device_id = db.Column(db.ForeignKey('device.id'))

    security_code_enabled = db.Column(db.boolean, unique=True)
    security_code = db.Column(db.String)
    gate_lock_on = db.Column(db.boolean)
    pulse_time = db.Column(db.String)

    user = db.relationship('Device', primaryjoin='ConfigMisc.device_id == Device.id', backref='config_misc')

------------------------------------------


This time ( now that we have an initial migration )   do


- flask db migrate -m "add config_misc table "  

- flask db upgrade


This didnt work and I didnt get a new migration version. But doing \d shows the new table. Im not sure whats going on



------------------------------------

vgr_12db=> \d
 public | alembic_version               | table    | dgleeson3
 public | config_misc                   | table    | dgleeson3
 public | device                        | table    | dgleeson3


-------------------------------------

See   https://github.com/miguelgrinberg/Flask-Migrate/issues/262




10/11/24    2nd
--------

Generate new SQL file to allow Flask db model file to be generated  ->   ok done

copied to folder      ->   flask_blog/ PostgtressSQLDesign/Rev8


need to generate a new models file and make required updates. Then run migrate to update database.

-------------------
Is it possible that the flask migrate tool needs the models in the same file as the reference to the db and alembic ?????

https://github.com/miguelgrinberg/Flask-Migrate/discussions/512

also see:   https://blog.miguelgrinberg.com/post/how-to-add-flask-migrate-to-an-existing-project

also see:  https://www.reddit.com/r/flask/comments/sn6atr/does_flask_migrate_affect_the_data_inside_of_a/
-------------------



10/11/24
--------

Running flask migrate is generating nothing.

------------------------------
(venv) dgleeson3@penguin:~/flask_blog$ flask db migrate -m "initial migration"
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.ddl.postgresql] Detected sequence named 'keypad_code_id_seq' as owned by integer column 'keypad_code(id)', assuming SERIAL and omitting
INFO  [alembic.ddl.postgresql] Detected sequence named 'post_id_seq' as owned by integer column 'post(id)', assuming SERIAL and omitting
INFO  [alembic.ddl.postgresql] Detected sequence named 'phone_number_id_seq' as owned by integer column 'phone_number(id)', assuming SERIAL and omitting
INFO  [alembic.ddl.postgresql] Detected sequence named 'open_number_white_list_id_seq' as owned by integer column 'open_number_white_list(id)', assuming SERIAL and omitting
INFO  [alembic.ddl.postgresql] Detected sequence named 'out_of_hours_id_seq' as owned by integer column 'out_of_hours(id)', assuming SERIAL and omitting
INFO  [alembic.env] No changes in schema detected.
-------------------------------------


So next add a new table. Configuration options for voyager switch.                ok done

-----------------------------
config_misc     table

id
device_id              
Security_code_enable   BOOLEAN
Security_code          VARCHAR ( 4 digits limited by interface )
gate_lock_on           BOOLEAN
pulse_time             VARCHAR ( value 1 - 10 limited by interface )
----------------

And fix fields in phone_number, keypad_code open_number_white_list and out_of_hours tables      ok done

start on tables display and elements in dbdiagram.io                    ok done



8/11/24
-------

Flask-Migrate is a Flask extension based on the Alembic library, allowing you to manage database migrations.

Database migration is transferring data between different database schemas without any data loss. Its commonly used to upgrade a database, change its schema by adding new table columns or relationships, and ensure a smooth transition with minimal downtime and no data loss.

To get flask migrate to work
----------------------------------
(venv) dgleeson3@penguin:~/flask_blog$ export FLASK_APP=run.py

(venv) dgleeson3@penguin:~/flask_blog$ flask db init
  Creating directory '/home/dgleeson3/flask_blog/migrations' ...  done
  Creating directory '/home/dgleeson3/flask_blog/migrations/versions' ...  done
  Generating /home/dgleeson3/flask_blog/migrations/README ...  done
  Generating /home/dgleeson3/flask_blog/migrations/alembic.ini ...  done
  Generating /home/dgleeson3/flask_blog/migrations/env.py ...  done
  Generating /home/dgleeson3/flask_blog/migrations/script.py.mako ...  done
  Please edit configuration/connection/logging settings in '/home/dgleeson3/flask_blog/migrations/alembic.ini' before proceeding.
------------------------------------------



==========================================
Next - 

1) have an error in 
------------------
  File "/home/dgleeson3/flask_blog/flaskblog/templates/showdevices.html", line 6, in block 'content'
    <h2>Your Devices at this Site. Site Name: {{ devices[0].access_point_name }} </h2>
------------------

OK I just removed my efforts to give the site name at the top of the device list at that site.


2) Find a way to change and grow the database without loosing data and existing tables

*****************************
4)  Error adding device to Site 3. Device added but still error from web site   ????

OK now getting      "Your New device has been created"
So its just about where we aer directing the web site after the commit.

5) Sort device configuration tabs and updating device details from there

6) Fix errors and problems. -> Target Embedded interface 
*******************************




28/10/24
--------

Got device id selected on device settings for phone number table.

See    http://127.0.0.1:5000/devicesettings/1

and  route
---------------
@app.route('/devicesettings/<int:device_id>',methods=['GET','POST'])
@login_required
def device_settings(device_id):
---------------



25/10/24
---------

I eventually found the syntax error in my flask function. Missing paramter in first line

-----------------------------------------------------------
WRONG
-----

@app.route('/devicesettings',methods=['GET','POST'])
@login_required
def device_settings(device_id):

RIGHT
-----
@app.route('/devicesettings/<int:device_id>',methods=['GET','POST'])
                            ---------------
@login_required
def device_settings(device_id):
----------------------------------------------------------------------------


NEXT:   When adding device details I need to add device id so I can pick device details by id in 
SQL Query



21/10/24
--------

ToDo

1) Click on device gives config screens

2) device display


2) sequences to and back from a device to be fixed.

4) List devices with a) device local name; Device Type; device phone  number

5) Add new Site button should only work/exist when looking at sites. So have buton on page.

6) Add new device screen needs a cancel button

20/10/24
--------

1)  change names of html and route to site from post            ok

2)  Get New Site and New device buttons working.

3) Notes on linking Showdevices and add_device

    A) we do http://127.0.0.1:5000/showsites
    B) Click on a device   Denis Gleeson ->  http://127.0.0.1:5000/showdevices/1

This uses the route in route.py   --->    /showdevices   with a GET specified -> We see a list of devices 
for this site
------------------CUT----------------------------------------
#
#  show devices given site id
#
# The top row lists a .html page. SO make sure .html page defined.
@app.route("/showdevices/<int:site_id>")
def show_device(site_id):
    form = ShowDevicesForm()
    if form.validate_on_submit():
       print("device route, show devices given site id - POST")
       print(site_id)

       return redirect(url_for('home'))

    elif request.method == 'GET':
       print("showdevices route, show devices given site id - GET")
       devices = Device.query.filter_by(site_id=site_id)
       return render_template('showdevices.html',site_id=site_id, devices=devices, form=form)
-----------------CUT-------------------------------

In the showdevices.html we have a button that takes us to the adddevice route  -->  /adddevice

As long as that link is sending a get request we will just see the page for adding a device

--------------CUT--------------------
<div class="form-group">
  <h2>All of Your Devices. </h2>

  <form action="{{ url_for('add_device', site_id=site_id) }}" method="GET">
    <input class="btn btn-danger" type="submit" value="Add New Device to this Site">

    {% for device in devices %}
--------------CUT-----------------------  




19/10/24
--------

To Do List

1) Add a New device - not working
2) Cliking into a device should give device configuration settings
How do we click into device ??
3) change device type to descriptive string instead of typedef number.
4) List devices with a) device local name; Device Type; device phone  number
5) Add new Site button should only work/exist when looking at sites. So have buton on page.


11/10/24
--------

I have working display of device details.

But its the same display for both sites. So the query has to be per site.

I had
    devices = Device.query.all()

But using 

    devices = Device.query.filter_by(site_id=site_id)
    
means that we filter the devices by the site_id field given to the route 

@app.route("/showdevices/<int:site_id>")



10/10/24
---------

Problem getting showdevices.html to display device details.  NOt sure whats happening.

Find where this is falling down

1) revert to something that is working like showsites.html
2) change gradually to showdevices and see where we get the problem

8/10/24
-------

1) Make it obvious -> List of Sites
                    -> List of Devices


                    


On Site view page list all devices on that site allowing to click 
   into each device for configuration.  Heading should be the site Name ONLY

2) going back from device goes back through add device which isnt correct.

3) Fix configuration tabs for Voyager 4G-2R switch

4) Gloss up Device configuration 


6/10/24
-------
Now have site_id working and getting passed into device setup

To get a new device saved into device table I had to set the device_type_name as an int in python as thats 
what it is set as in the database. Undecided whether I stick with this approach. I need to translate on occasion between inetger and actual String name for the type.

Checking table contents with psql
---------------------------------------

vgr_12db=> select * FROM user;
   user    
-----------
 dgleeson3
(1 row)

vgr_12db=> select * FROM site;
 id | user_id |   site_name   | site_contact_details 
----+---------+---------------+----------------------
  1 |       1 | Denis Gleeson | 0872730966
(1 row)

vgr_12db=> select * FROM device;
 id | device_type_name | device_sim_number | access_point_name | site_id 
----+------------------+-------------------+-------------------+---------
  1 |                3 | 0872730966        | Main Gate         |       1
(1 row)

-----------------------------------------------------------


2/10/24_2
-------

Saving the new record for the device table I need the site_id as its the reference to the site class

BUt this killed my program.  I needed to start sending the site_id to the url

http://127.0.0.1:5000/adddevice    is no longer a route, we must have device_id

also now added to adddevice.html

        <form action="{{ url_for('adddevice', site_id=site.id) }}" method="POST">

This is now getting messy. Is there an easy way to get the site_id ???

2/10/24
-------

Removed Device_type form the database schema and the models.py file. It was over complicated.

Need to also remove from routes.py etc     ok

Now need to get back to adding new site details to the database.

Continue then top set device settings.

Get back to input validation later


26/9/24
-------

Using the CRUD project I got the detection of POST in the route working.

Next. create a table of 2 columns amd 2 rows in the add device page.
Get all 3 device settings and submit to the database

DO the validation of the input for this device -> do we need a Flask form
------------------------------
A) table                                ok
B) Flask Form for validation            

-------------------------------

Current example of flask form for validation

See login.html and loginform

and 

create_post.html and postform

These are very Flask dependant

It woukld be easier to use html forms and use html validation. See if this makes 
sense in flask  ???
-------------------------------
 
C) Route checks validation
D) Save new site to database in route and then move to devicesettings.html to allow setting device config details


25/9/24
--------

1) Problems with handling POST or form validation in Adddevice.html

Setup CRUD project to test its operation with POST

python3 -m venv venv
source venv/bin/sctivate
pip install -r /path/to/requirements.txt

Great style on this project. Just need a bit lighter background BUT use this CSS



20/9/24
-------

To Do


1) Using Site table, add devices and display them for that site

2) configure devices and access them repeatedly from the device list





15/9/24
-------

ToDo

A) Use site / device_type  tables.
  - list sites on login. clicking on site in list gives device installed and clicking on device gives device configuration
  
B) link to phone number table
    
allow sites and devices and device configuration to be added andchanged.

-------------------------------------------------------------------
Now getting phone number table details to display           ok

Next fill in actions for UPdate and Delete  


--------------------

Next
----

A)  STart using user table instead of POST table. Get current level of functionality.

- In Diagnostics Tab handle user table, display and add/delete from that table

    - a) do display         
    - b) do addition                ok
    - c) do deletion

B)  Get requirements and upload site to web

C)  Get Embedded platform - Arduino to read user table and get settings to program as white list

look at Arduino fonatest on the silver laptop




01/9/24
-------

1) Now able to add and delete from the device settings html pages Tab 2

I discovered a problem with checking if this user owns the post he was requesting to delete.

See commented out code in route \post\post_id\delete

2) Still using the post table as if it was a whitelist table. -> Need to move to using user table

3)

-----------------------------------------------------------------
============
To Do
============


Use correct tables for Sites/Devices/settings
---------------------------------------------

White list display and UPdate
------------------------------

1)  Round + sign to add new User to white list. Brings up dialog to enter Name and Number.
Details added to bottom of list

2)  In Line on Row   --->  Edit and Remove buttons.


Next to do

1) Display users name and phone number
2) Screen to add new user with details
3) remove a user
4) Edit a user


---------------------
Note

Backup Linux Apps and files

1) Bottom right, click on time -> about -> Linux -> backup.
2) Plug in HDD and select location for BU


25/8/24
-------

Fixed home page problem.

see contents of DB with psql command line

1) OPen DB      pp

2) see tables   \dt

3) See table contents

vgr_9db=> SELECT * FROM post;

 id |    title    |     date_posted     | content | user_id 
----+-------------+---------------------+---------+---------
  1 | Test Site 1 | 2016-06-22 19:10:25 | VV-IKL  |       1
  2 | Test Site 2 | 2016-06-22 19:10:25 | 4G-2R   |       1
  4 | Mary Smiths | 2016-06-22 19:10:25 | 4G-2R   |       1
  6 | JJ Bryan    | 2016-06-22 19:10:25 | 4G-2R   |       1
(4 rows)




24/8/24
--------

MOving through screens from start to looking at device settings and viewing 3 tabs is working

I had to remove references to Author for posts and html screens. It was just substituted by user_id
Also I dont have image file so references removed
Also the time set for posts was just all set to the same time.


Moving around screens like going back home not all working - Not sure why

Keep getting this odd white screen on occasion requiring Chrpmebook power down and up

BUGS:
-----

1) Using Home and doing login is giving method NOT allowed

2) now getting GET /home HTTP/1.1" 302 -  when I go to home


21/8/24
-------

Problems on login

AttributeError: 'User' object has no attribute 'is_active'

https://stackoverflow.com/questions/26606391/flask-login-attributeerror-user-object-has-no-attribute-is-active


20/8/24_4
---------
Getting an error on registration when python tries to add a new user to table.

 flask-sqlacodegen   is not exactly generating what we had in the original models.py file

I am removing the Varchar[XX] size specification from the database design and work on generating a new vgr_7db

New database vgr_8db

Then I had an error where the user id was NULL, I had to change the id to be serial on all tables.


New database vgr_9db

SEQUENCE to CREATING A NEW database   --------------------------------

1) New diagram -> exported to .sql file

copy the psql file to the project (flask_blog) folder

2) create new database from command line

createdb vgr_6db

3) enter     psql vgr_6db

4) create tables in new database using psql and .sql file

\i db_design_7.sql            ---> this was the sql output from the table and database design tool

 check correct tables and relationships have been setup

\dt


5) \q from psql
6) now create flask interface file for SQLAlchemy. Creates models.py

flask-sqlacodegen --flask postgresql:///vgr_10db >> models.py

*** Watch out this step adds (appends) to the existing file


7) check models.py is correct  -> I am adding a section to top of new file, copy from previous

8)  Add UserMixin  to user table

see models.py.bu

class User(db.Model, UserMixin):

9)  need to target the new database on the init_.py file

app.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://dgleeson3:access45@localhost/vgr_11db'


-------------------------------------------------

19/8/24_3
---------

Solution below works as I am not faialing on boot.


19/8/24_2
-------------

Last attempt still fails


https://stackoverflow.com/questions/48999379/psycopg2-operationalerror-fatal-password-authentication-failed-for-user-my-u
------

sudo su - postgres
CREATE USER dgleeson5 WITH PASSWORD 'access45';
GRANT CONNECT ON DATABASE vgr_6db TO dgleeson5;
GRANT ALL PRIVILEGES ON DATABASE vgr_6db  to dgleeson5;
\q
logout

19/8/24_1
-------

problem with wrong password.

Use postgres shell to change password

--------------

https://stackoverflow.com/questions/27107557/what-is-the-default-password-for-postgres

[LINUX]

might work for windows too

After installing postgres follow following steps in order to setup password for default system account of Linux execute following in terminal:

user:~$ sudo -i -u postgres
postgres@user:~$ psql
after executing above two commands you will get into postgres shell

Execute this query in postgres shell:

postgres=# ALTER USER postgres PASSWORD 'mynewpassword';
your new password is 'mynewpassword' without quotes and now you can connect with external GUI tools like DBeaver

Use 'logout' to exit shell

------------------------------------

18/8/24
--------

To see environmnent variables  use    

env

To get the specific value

echo $varname 


17/8/24
--------

1) Crete dummy db

command line 

createdb vgr_6db

2) psql vgr_6db

3) \i db_design_3.sql            ---> this was the sql output from the table and database design tool

4) check correct tables and relationships have been setup

5) create flask models.py for new db

flask-sqlacodegen --flask postgresql:///vgr_2db >> models.py

6) check models.py is correct




-------  Next

a) substitute models.py into our project

VARCHAR didnt work

b) point flask at the database

See   https://www.digitalocean.com/community/tutorials/how-to-use-a-postgresql-database-in-a-flask-application





13/8/24
-------

ToDo

using example app

https://medium.com/nerd-for-tech/developing-a-simple-create-read-update-and-delete-crud-application-using-flask-and-mariadb-f037a5798ee2


    a) add to my flask App
        edit            1) add text 2) handle press 3) new screen to allow edit
        delete 
        add new.
    
    b) all above update database as per example above
    
    c) add posts table and other table, change database


12/8/24
-------

I have table displaying db table.

- Next allow edit / delete / create new / save


5/8/24 - 8/8/24
---------------


revert to finding flask html code to display a table of data from db 

https://stackoverflow.com/questions/76007241/display-data-on-html-from-mysql-database-using-flask

Now add some users to table read and display  - use psql command line to add and show first

I want to keep the tab display so I should call the template showing tabs and displaying the details read.


4/8/24
-------

So far so good

I need samples of displaying database details like user tables
And details of update/delete/save/create

an interesting sample

https://medium.com/@jmartinez729/full-crud-with-javascript-1c3fb77f81f

https://github.com/buttcheeksio/book-lister-app-full-crud-js?source=post_page-----1c3fb77f81f--------------------------------

I only have pip installed and on the python3 venv

See  https://pypi.org/project/json-server/

so to install json server

----------------------

dgleeson3@penguin:~/flask_blog$ source venv/bin/activate

(venv) dgleeson3@penguin:~/bookproject$         pip install json_server                 ** Note underscore **

Then run server

json_server books.json                              ** Note underscore **

-----------------------



30/7/24
-------

Setup tabs for the configuration of the device.

See:

https://www.w3schools.com/w3css/w3css_tabulators.asp


26/7/24
-------

1)  add new page to accept ID and main settings for new device.
2) Go from add device to this page
3) after this page display site with new device added. And any other added devices


Next -> The Device added should be displayed on site list
     -> clicking on device gives configuration screens for that device

25/7/24
-------

1) options buttons and other UI displayed on adddevice.html


24/7/24
-------

Finally go button to change the web page using this jinga approach

SO button post page links to home page

See   stackoverflow.com   "flask make a button direct to another page"

       <button id="test" type="button" class="btn btn-default" onclick="window.location.href = '{{ url_for('home') }}'; " class="button">Add new Site </button>
------------------------------------
And then to my new page. Now just showing a button

        <button id="test" type="button" class="btn btn-default" onclick="window.location.href = '{{ url_for('add_device') }}'; " class="button">Add New Device to this Site </button>




23/7/24
-------

Error in home page login not working. Need to press login


Cant get divert to a different page in function

https://sentry.io/answers/redirect-to-a-url-in-flask/#:~:text=Redirection%20in%20Flask%20can%20be,same%20application%20and%20external%20websites


21/7/24
-------

1) New icons required, site, device ( intercom & Switch, )
 Registerd user and device user.

2) when we click on a site we get a button "Add a new device to this site"

This brings up a new page to add
    a) select a device type
    b) add it to the site
    c) or cancel this operation


Process
a) add new form in forms.py 
---------------------------

Adding Radio Field
See https://gist.github.com/doobeh/4667330


  import RadioField from wtforms

class AddDevice(FlaskForm):
#    title = StringField('Site Name(Site Owner)', validators=[DataRequired()])
#    content = TextAreaField('Product at Site', validators=[DataRequired()])
    option = RadioField(choices=[('dog', 'Dog'), ('cat', 'Cat'), ('bird', 'Bird'), ('alien', 'Alien')])
    submit = SubmitField('Add this Device to Site')    

b) add a new route
-------------------

@app.route('/adddevice',methods=['GET','POST'])
def hello_world():
    form = AddDevice()
    if form.validate_on_submit():
        print(form.example.data)
    else:
        print(form.errors)
    return render_template('adddevice.html',form=form)



c) add a new html template file
-------------------------------
{% extends "layout.html" %}
{% block content %}
<div class="form-group">
  {{ form.submit(class="btn btn-outline-info") }}
</div>

{% endblock content %}

d) add button to Site view to add a new device
----------------------------------------------
place correctly in current post.html to show button under existing content on page


Adding link to another internal or external page
https://sentry.io/answers/redirect-to-a-url-in-flask/#:~:text=Redirection%20in%20Flask%20can%20be,same%20application%20and%20external%20websites

Two approaches - button in HTML or button in python function

1) Button in html



 

-------------------------------------------------------------

19/7/24 ---------------
-------

Trying to find a way to auto generate the GUI with drag and drop IDE

Nothing relating to Flask or Jinga available so far 

ToDo

1) Find a source of html samples for 1 designed page of interface

2) add html code to a new template or static html file in the project

3) continue this process of creating sample html code and adding to GUI

--
First change

1) change the site page to have an 

add device at site. Button.

This is a new page with a list of device types where 1 can be selected.

Adding a device Adds that device to the device list at that site and clicking on the device allows for its configuration.
--



---------------
Next Steps

A) introduce new db and models.py to my current flask blog project. Keep current functionality. might be best to include existing items or tables into new database to keep current functionality. 

B) Allow logged in user to create new sites and devices. 
These sites should only be visible to this logged in user

C) Continued work on the GUI for Site, Device, user creation  and configuration.
---------------



status  14/6/24  Part 3 -----------------------------
---------------

1) For autogeneration of models .py

https://stackoverflow.com/questions/17652937/how-to-build-a-flask-application-around-an-already-existing-database

https://github.com/ksindi/flask-sqlacodegen

command line to generate models.py

flask-sqlacodegen --flask postgresql:///vgr_2db >> models.py


status  14/6/24  Part 2 -----------------------------
---------------

Installing sqlacodegen gave following error
-----------------------------------------------
(venv) dgleeson3@penguin:~/flask_blog$ pip install sqlacodegen
Collecting sqlacodegen
  Downloading sqlacodegen-2.3.0.post1-py2.py3-none-any.whl (13 kB)
Collecting SQLAlchemy<2.0,>=0.9.0
  Downloading SQLAlchemy-1.4.52-cp39-cp39-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (1.6 MB)
     || 1.6 MB 376 kB/s 
Collecting inflect>=0.2.0
  Downloading inflect-7.3.1-py3-none-any.whl (34 kB)
Collecting typeguard>=4.0.1
  Downloading typeguard-4.3.0-py3-none-any.whl (35 kB)
Collecting more-itertools>=8.5.0
  Downloading more_itertools-10.3.0-py3-none-any.whl (59 kB)
     || 59 kB 388 kB/s 
Requirement already satisfied: greenlet!=0.4.17 in ./venv/lib/python3.9/site-packages (from SQLAlchemy<2.0,>=0.9.0->sqlacodegen) (3.0.3)
Requirement already satisfied: typing-extensions>=4.10.0 in ./venv/lib/python3.9/site-packages (from typeguard>=4.0.1->inflect>=0.2.0->sqlacodegen) (4.12.2)
Requirement already satisfied: importlib-metadata>=3.6 in ./venv/lib/python3.9/site-packages (from typeguard>=4.0.1->inflect>=0.2.0->sqlacodegen) (7.1.0)
Requirement already satisfied: zipp>=0.5 in ./venv/lib/python3.9/site-packages (from importlib-metadata>=3.6->typeguard>=4.0.1->inflect>=0.2.0->sqlacodegen) (3.19.2)
Installing collected packages: typeguard, more-itertools, SQLAlchemy, inflect, sqlacodegen
  Attempting uninstall: SQLAlchemy
    Found existing installation: SQLAlchemy 2.0.30
    Uninstalling SQLAlchemy-2.0.30:
      Successfully uninstalled SQLAlchemy-2.0.30
ERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.
flask-sqlalchemy 3.1.1 requires sqlalchemy>=2.0.16, but you have sqlalchemy 1.4.52 which is incompatible.
Successfully installed SQLAlchemy-1.4.52 inflect-7.3.1 more-itertools-10.3.0 sqlacodegen-2.3.0.post1 typeguard-4.3.0




status  14/6/24 -----------------------------
---------------

1)   Working on creaing a database for the project. A simplified version of the total project

using:                                                               
------
p

Good example
https://dbdiagram.io/d/Copy-of-Sample-DBD-for-Airbnb-66801bf49939893dae99e7f2

Important on which side is foreign key in table relationship
------------------------------------------------------------
https://www.quora.com/What-side-gets-the-foreign-key-the-one-or-many#:~:text=The%20foreign%20key%20constraint%20is,on%20the%20%E2%80%9Cmany%E2%80%9D%20side.

2) installed postgressql on chromebook. Using for running script to create database.

See big green notebook

Useful links on postgresql
--------------------------
https://medium.com/analytics-vidhya/how-to-create-a-postgres-database-394b362abfbe
https://medium.com/codex/intro-to-postgresql-c8da31335c34


Using new design db_design_2.sql I can now create the postgresql database witthout errors

3) Next we will try and auto create flask database model file from database using the tool 

https://pypi.org/project/sqlacodegen/



status  21/6/24 -----------------------------
---------------

1) Just corey schafer from video 8
2) I had to fix problem with no database available
Taken from stack overflow'
run.py is now

-----------------------------------------
from flaskblog import app
from flaskblog import db

if __name__ == '__main__':
  with app.app_context():
    db.create_all()    
    app.run(debug=True)
---------------------------------------------   

Prior to this see Green Folder big note book, and before that copy book


===============================================================
BUGS   ---------------------------------------------------
===============================================================

----------------------------------------
App version / date
Bug details

Bug Significance  LOW/MEDIUM/HIGH
---------------------------------------

--------------------------------------------
App version / date   - Lamine 5/4/25
Bug details
-----------
Moving around the App using the back browser button creates a number of problems.

- ON one occasion
    - I logged out of user 2 and logged in as user 1 ( all setup as listed below)
    - Using the  back button to get back from a site to get to the list of sites, I ended up with a list of sites for user 2.
      I could then even access sites belongoing to user 2 and 
      
Bug Significance  LOW  - this bug is unlikely to happen when Installer using the app. As he would not login as different users.
----------------------------------------------
